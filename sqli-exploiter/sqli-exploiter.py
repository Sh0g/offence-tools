import datetime
import time
from report import make_report
from config import *
from injector import Injector, InjectorException
import logging
from subprocess import call

def main():
    # configure logging
    URL = input("Enter the target URL: ")
    URL = f"http://{URL}"
    start_time = time.time()
    loglevel = getattr(logging, LOGLEVEL.upper())
    logging.basicConfig(format='%(levelname)s %(message)s', level=loglevel)
    logging.addLevelName(logging.INFO, '[-]')
    logging.addLevelName(logging.WARN, '[*]')
    logging.addLevelName(logging.ERROR, '[!]')
    # configure debug logging for requests
    if loglevel == logging.DEBUG:
        # debug HTTP requests
        import http.client as http_client
        http_client.HTTPConnection.debuglevel = 1
        # initialize logging, otherwise you'll not see debug output
        requests_log = logging.getLogger("requests.packages.urllib3")
        requests_log.setLevel(loglevel)
        requests_log.propagate = True
    i = Injector()
    try:
        i.set_attack(ATTACKS, ATTACK, PAYLOADS)
        i.condition = condition
        i.success = success
        i.exploit(URL, PARAMS, DATA, HEADERS)
    except InjectorException as e:
        logging.error(e)
    except KeyboardInterrupt:
        pass
    end_time = time.time()
    execution_time = end_time - start_time
    current_date = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    date = (f"Function executed in {execution_time:.6f} seconds on {current_date}")
    make_report("SQLi Scanner", URL, i.result, "sqli_report.pdf", date)

if __name__ == '__main__':
    main()
    call(["python", "run.py"])
